# 콘서트 예약 서비스 부하 테스트 보고서

**작성일**: 2025년 12월 8일  
**작성자**: 문예진  
**테스트 환경**: Docker Desktop (Apple Silicon)

## 1. 개요

### 1.1 배경
콘서트 예약 서비스는 티켓 오픈 시 순간적인 트래픽 집중이 발생합니다. 특히 결제 처리는 금융 시스템 수준의 신뢰성이 요구되며, 다음 항목들이 보장되어야 합니다:
- 중복 결제 방지
- 잔액 정합성 100% 보장
- 동시 요청 순서 보장

### 1.2 목적
1. 시스템 최대 처리량(TPS) 및 한계점 파악
2. 리소스별 적정 배포 스펙 도출
3. 병목 구간 식별 및 개선 방향 수립
4. SLA 기준 수립을 위한 기초 데이터 확보

### 1.3 테스트 대상
| API | 설명 | 선정 이유 |
|-----|------|----------|
| GET /api/wallet/{userId}/balance | 잔액 조회 | 가장 빈번한 호출, 캐시 효과 측정 |

---

## 2. 테스트 환경

### 2.1 인프라 구성
| 컴포넌트 | 버전 | 비고 |
|---------|------|------|
| Spring Boot | 3.x | 애플리케이션 서버 |
| MySQL | 8.0 | 데이터베이스 |
| Redis | 7.2 | 캐시 및 대기열 |
| Kafka | 7.5.0 | 이벤트 스트리밍 (3-broker 클러스터) |

### 2.2 테스트 도구
- **JMeter 5.6.3**: CLI 모드로 실행
- **wrk**: 보조 검증용

### 2.3 테스트 데이터
- 테스트 유저: 500명 (test-user-0001 ~ test-user-0500)
- 초기 잔액: 1,000,000원
- UUID 패턴: `00000000-0000-0000-0000-XXXXXXXXXXXX`

---

## 3. 테스트 시나리오

### 3.1 잔액 조회 부하 테스트
| 항목 | 설정값 |
|------|--------|
| 동시 사용자 (Threads) | 100 |
| Ramp-up 시간 | 30초 |
| 테스트 지속 시간 | 60초 |
| 대상 API | GET /api/wallet/{userId}/balance |

---

## 4. 테스트 결과

### 4.1 리소스별 성능 비교

| 스펙 | TPS | 평균(ms) | 최대(ms) | 에러율 | CPU% | MEM% | 상태 |
|------|-----|---------|---------|--------|------|------|------|
| 0.25CPU / 256M | - | - | - | 100% | 25% | 99.9% | 🔴 OOM |
| 0.5CPU / 512M | 134 | 560 | 5,699 | 0% | - | - | 🟡 느림 |
| 1CPU / 512M | 4,088 | 18 | 7,846 | 0% | - | - | 🟢 양호 |
| 2CPU / 1G | 3,380 | 22 | 7,888 | 0% | 208% | 39% | 🟢 양호 |

### 4.2 SLA 달성 여부 (1CPU / 512M 기준)

| 지표 | 목표 | 실측 | 달성 |
|------|------|------|------|
| TPS | > 500 | 4,088 | ✅ (8배 초과) |
| 평균 응답 시간 | < 200ms | 18ms | ✅ |
| P99 응답 시간 | < 1000ms | ~500ms | ✅ |
| 에러율 | < 1% | 0% | ✅ |

---

## 5. 분석 및 결론

### 5.1 핵심 발견사항

#### 메모리 최소 요구사항
- **256MB: 서비스 불가** (OOM 발생, 에러율 100%)
- **512MB: 안정적 운영 가능**
- Spring Boot + JPA 애플리케이션 특성상 최소 512MB 이상 필요

#### CPU 영향도
- **0.5 CPU → 1 CPU**: TPS 30배 증가 (134 → 4,088)
- **1 CPU → 2 CPU**: TPS 변화 미미 (4,088 → 3,380)
- 단순 읽기 작업에서는 1 CPU로 충분

#### 메모리 영향도
- **512MB → 1GB**: 성능 차이 거의 없음
- 현재 워크로드에서 메모리는 병목이 아님

### 5.2 병목 분석
1. **CPU**: 0.5 CPU 이하에서 급격한 성능 저하
2. **메모리**: 256MB에서 OOM 발생
3. **네트워크/DB**: 현재 테스트에서는 병목 아님

### 5.3 적정 배포 스펙 권고

| 환경 | CPU | Memory | 예상 TPS | 비고 |
|------|-----|--------|----------|------|
| **최소 스펙** | 0.5 | 512M | ~130 | 개발/테스트 환경 |
| **권장 스펙** | 1.0 | 512M | ~4,000 | 일반 운영 환경 |
| **고성능 스펙** | 2.0 | 1G | ~3,500 | 피크 트래픽 대응 |

**권장: 1 CPU / 512MB**
- 비용 대비 성능 효율 최적
- 4,000 TPS로 대부분의 트래픽 처리 가능

---

## 6. 향후 계획

### 6.1 추가 테스트 필요
1. **예약 플로우 테스트**: 토큰 발급 → 좌석 배정 → 결제 확정
2. **동시성 테스트**: 같은 좌석에 대한 동시 예약 시나리오
3. **장기 부하 테스트**: 30분 이상 지속 부하

### 6.2 개선 방안
1. 캐시 적용 확대 (Redis)
2. 커넥션 풀 최적화
3. DB 쿼리 최적화
