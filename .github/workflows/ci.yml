name: CI

# 언제 실행?
on:
  # PR 생성하거나 업데이트할 때
  pull_request:
    branches: [ main, develop ]

  # main 브랜치에 push할 때
  push:
    branches: [ main ]

jobs:
  test:
    name: 테스트 실행
    runs-on: ubuntu-latest  # GitHub이 제공하는 Ubuntu 서버

    steps:
      # 1. 코드 가져오기
      - name: 코드 체크아웃
        uses: actions/checkout@v4

      # 2. Java 17 설치
      - name: Java 17 설치
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
          cache: 'gradle'  # Gradle 캐시로 빌드 속도 향상

      # 3. Gradle 실행 권한 부여
      - name: Gradle 실행 권한 부여
        run: chmod +x gradlew

      # 4. 테스트 실행
      - name: 테스트 실행
        run: ./gradlew test

      # 5. 테스트 결과 리포트
      - name: 테스트 결과 업로드
        uses: actions/upload-artifact@v4
        if: always()  # 성공/실패 상관없이 항상 실행
        with:
          name: test-results
          path: build/reports/tests/test/
          retention-days: 7  # 7일간 보관